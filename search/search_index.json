{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Setting Up brewdata Package with dbt Core and Snowflake","text":"<p>This guide provides a step-by-step walkthrough for setting up and using the brewdata package with dbt Core and Snowflake.</p>"},{"location":"#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following:</p> <ul> <li>Snowflake account with appropriate permissions</li> <li>Python (&gt;=3.10) installed on your system</li> <li>Basic familiarity with dbt and Snowflake</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<p>This will run your dbt model while utilizing the brewdata package. For detailed step-by-step instructions, please refer to our Setup Guide which covers:</p> <ol> <li>Installing dbt Core and Snowflake adapter</li> <li>Initializing a new dbt project</li> <li>Configuring Snowflake connection</li> <li>Downloading and uploading the brewdata package</li> <li>Running a dbt model with brewdata integration</li> </ol> <p>The guide includes code examples and configuration details to help you get started quickly.</p>"},{"location":"#additional-resources","title":"Additional Resources","text":"<p>To learn more about configuration options and available strategies, click here.</p> <p>This guide ensures a smooth installation and setup process for dbt Core and the brewdata package in Snowflake.</p>"},{"location":"strategies/","title":"brewdata Strategy Documentation","text":""},{"location":"strategies/#standard-strategies","title":"Standard Strategies","text":"ID Strategy Name Semantic Group 1 Address (Random) address 2 Street Name (Random) address 3 City (Random) address 4 State (Random) address 5 Person Name (Random) name 6 First Name (Random) name 7 Last Name (Random) name 8 Date (yyyy-mm-dd) date 9 Phone Number (Random) phone_number 10 Phone Number (By CountryCode) phone_number 11 License Plate (Random) license_plate 12 SSN (Random) national_id 13 SAID (Random) national_id 14 Job (Random) job 15 Personal Email (Random) email 16 Company Email (Random) email 17 IPv4 Address (Random) ip_address 18 Domain Name (Random) domain_name 19 Device MAC Address (Random) device_address 20 Credit Card Number (Random) credit_card 21 Bank Account (Random) bank_account 22 Swift Code (Random) swift_code 23 Random Number random_number 24 Random Letters random_letters 25 Country (Random) address 26 Checksum checksum 27 Barcode (Random) barcode 28 Color (Random) color 29 Date Time (yyyy-mm-dd hh:mm:ss) date 30 Land Coordinates (Random) land_coordinates 32 Gender (Random) gender 33 Date Number (yyyymmdd) date 34 Building Number (Random) address 35 Address Line1 (Random) address 36 Address Line2 (Random) address 37 Company Name (Random) company 38 Postal Code (Random) address 39 Zipcode (Random) address 40 Credit Card Type (Random) credit_card 41 Credit Card Expiry Date (Random) credit_card 44 Year (yyyy) date 45 Month Number (mm) date 46 Day Number (dd) date 47 RegEx Pattern random_letters 48 State Code (Random) address 49 Telephone Number (Random) phone_number 53 Province (Random) address 85 Random Alpha Numeric random_alpha_numeric 86 IPv6 Address (Random) ip_address"},{"location":"strategies/#gan-strategies","title":"GAN Strategies","text":"<p>These strategies use different GAN models for synthetic data generation. The appropriate strategy (categorical/numeric) is applied based on the column type.</p> ID Strategy Name Type 59 CTGAN Neural Network Categorical 60 CTGAN Neural Network Numeric 61 TVAE Neural Network Categorical 62 TVAE Neural Network Numeric 63 CopulaGAN Neural Network Categorical 64 CopulaGAN Neural Network Numeric 65 Transformer Neural Network Categorical 66 Transformer Neural Network Numeric 67 NoGAN Categorical 68 NoGAN Numeric"},{"location":"example/quickstart-setup/","title":"Setup","text":""},{"location":"example/quickstart-setup/#step-1-install-dbt-core","title":"Step 1: Install dbt Core","text":"<p>To install dbt Core and the Snowflake adapter, run:</p> <pre><code>pip install dbt-core dbt-snowflake\n</code></pre> <p>Verify the installation with:</p> <pre><code>dbt --version\n</code></pre>"},{"location":"example/quickstart-setup/#step-2-initialize-a-dbt-project","title":"Step 2: Initialize a dbt Project","text":""},{"location":"example/quickstart-setup/#1-create-a-directory-for-your-dbt-project","title":"1. Create a directory for your dbt project:","text":"<pre><code>mkdir my_dbt_project\ncd my_dbt_project\n</code></pre>"},{"location":"example/quickstart-setup/#2-initialize-a-new-dbt-project","title":"2. Initialize a new dbt project:","text":"<pre><code>dbt init\n</code></pre>"},{"location":"example/quickstart-setup/#3-configure-snowflake-connection","title":"3. Configure Snowflake Connection:","text":"<p>During initialization, you'll be prompted to enter your Snowflake connection details: - Profile name    (default is the project name)</p> <ul> <li> <p>Database name</p> </li> <li> <p>Schema name</p> </li> <li> <p>Warehouse name</p> </li> <li> <p>Username</p> </li> <li> <p>Password    (or other authentication method)</p> </li> <li> <p>Account identifier</p> </li> <li> <p>Role    (optional)</p> </li> </ul>"},{"location":"example/quickstart-setup/#step-3script-download-and-upload-the-brewdata-package","title":"Step 3(Script): Download and Upload the brewdata Package","text":""},{"location":"example/quickstart-setup/#1-get-the-setup-script","title":"1. Get the setup script","text":"<p>You have two options:</p>"},{"location":"example/quickstart-setup/#option-a-download-the-script-file","title":"Option A: Download the script file","text":"<ul> <li>Download the <code>brewdata_setup.py</code> and place it in your <code>&lt;DBT_PROJECT&gt;</code> directory where <code>profiles.yml</code> file is present</li> </ul>"},{"location":"example/quickstart-setup/#option-b-create-the-script-manually","title":"Option B: Create the script manually","text":"<ol> <li>Create a new file named <code>brewdata_setup.py</code> in your <code>&lt;DBT_PROJECT&gt;</code> directory</li> <li>Copy and paste the following code into the file: <pre><code>from ast import Import\nimport os\nimport yaml\nimport sys\nimport subprocess\nimport argparse\nfrom pathlib import Path\n\ndef install_required_packages():\n    \"\"\"Install required packages if not already installed.\"\"\"\n    required_packages = [\"pyyaml\", \"requests\", \"snowflake-connector-python\"]\n    for package in required_packages:\n        try:\n            Import(package.replace(\"-\", \"\"))\n        except ImportError:\n            print(f\"Installing {package}...\")\n            subprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", package])\n\ndef get_dbt_profile():\n    \"\"\"Get the dbt profile based on the current directory name.\"\"\"\n    # Get current directory name\n    current_dir = str(Path(os.getcwd()).resolve())\n\n    # Clean up the directory name to match profile name format\n    profile_name = current_dir.replace('-', '_')\n\n    # Find profiles.yml location\n    if os.name == 'nt':  # Windows\n        profiles_path = os.path.join(os.environ['USERPROFILE'], '.dbt', 'profiles.yml')\n    else:  # Linux/macOS\n        profiles_path= os.path.join(Path(current_dir), 'profiles.yml')\n        if not os.path.exists(profiles_path):\n            profiles_path = os.path.join('/home', os.environ['USER'], '.dbt', 'profiles.yml')\n\n    # Check if profiles file exists\n    if not os.path.exists(profiles_path):\n        raise FileNotFoundError(f\"dbt profiles file not found at {profiles_path}\")\n\n    # Load profiles\n    with open(profiles_path, 'r') as f:\n        profiles = yaml.safe_load(f)\n\n    # Check if the profile exists\n    if profile_name not in profiles:\n        available_profiles = list(profiles.keys())\n        print(f\"Profile '{profile_name}' not found in profiles.yml.\")\n        print(f\"Available profiles: {available_profiles}\")\n\n        # Try to match with available profiles\n        for p in available_profiles:\n            if p.lower() == profile_name.lower():\n                profile_name = p\n                print(f\"Using profile '{profile_name}' instead.\")\n                break\n        else:\n            # Ask user to select a profile\n            print(\"Please select a profile:\")\n            for i, p in enumerate(available_profiles):\n                print(f\"{i}: {p}\")\n            selection = int(input(\"Enter profile number: \"))\n            profile_name = available_profiles[selection]\n\n    # Get the target profile (default is 'dev')\n    target_name = profiles[profile_name].get('target', 'dev')\n\n    # get the target profile\n    print(f\"Current Selected Target : {target_name} \\n Would you like to change it? (y/n)\")\n    change_target = input()\n    while change_target.lower() not in ['y', 'n']:\n        print(\"Invalid input. Please enter 'y' or 'n'.\")\n        print(f\"Current Selected Target : {target_name} \\n Would you like to change it? (y/n)\")\n        change_target = input()\n    if change_target.lower() == 'y':\n        print(\"Please select a target:\")\n        for i, p in enumerate(profiles[profile_name]['outputs'].keys()):\n            print(f\"{i}: {p}\")\n        selection = int(input(\"Enter target number: \"))\n        target_name = list(profiles[profile_name]['outputs'].keys())[selection]\n\n    target_profile = profiles[profile_name]['outputs'][target_name]\n\n    return profile_name, target_profile\n\ndef download_brewdata_package(download_path, github_url=None):\n    \"\"\"Download the brewdata package or use a local file.\"\"\"\n    import requests\n\n    local_path = os.path.join(download_path, \"brewdata_lib.zip\")\n\n    # Check if a local file already exists\n    if os.path.exists(local_path):\n        use_local = input(f\"Found brewdata_lib.zip in {download_path}. Use this file? (y/n): \")\n        if use_local.lower() == 'y':\n            print(f\"Using existing file at {local_path}\")\n            return local_path\n\n    # Download the file\n    print(f\"Downloading brewdata package from {github_url}...\")\n    response = requests.get(github_url, stream=True)\n    if response.status_code != 200:\n        raise Exception(f\"Failed to download package. Status code: {response.status_code}\")\n\n    # Save the file with progress indicator for large files\n    total_size = int(response.headers.get('content-length', 0))\n    block_size = 1024  # 1 Kibibyte\n\n    with open(local_path, 'wb') as f:\n        if total_size &gt; 1024*1024:  # Only show progress for files &gt; 1MB\n            print(f\"Downloading {total_size//(1024*1024)}MB file...\")\n            downloaded = 0\n            for data in response.iter_content(block_size):\n                downloaded += len(data)\n                f.write(data)\n                done = int(50 * downloaded / total_size)\n                print(f\"\\r[{'=' * done}{' ' * (50-done)}] {downloaded//(1024*1024)}MB/{total_size//(1024*1024)}MB\", end='')\n            print()\n        else:\n            f.write(response.content)\n\n    print(f\"Package downloaded to {local_path}\")\n    return local_path\n\ndef create_snowflake_stage_and_upload(profile, zip_file_path, stage_name=None):\n    \"\"\"Create a Snowflake stage and upload the ZIP file.\"\"\"\n    import snowflake.connector\n\n    # Connect to Snowflake\n    print(f\"Connecting to Snowflake as {profile['user']}@{profile['account']}...\")\n    conn = snowflake.connector.connect(\n        user=profile['user'],\n        password=profile['password'],\n        account=profile['account'],\n        warehouse=profile['warehouse'],\n        database=profile['database'],\n        schema=profile['schema'],\n        role=profile.get('role')\n    )\n\n    # If stage_name is not provided, create a default one\n    if not stage_name:\n        stage_name = f\"{profile['database']}.{profile['schema']}.BREWDATA_STAGE\"\n    else :\n        stage_name = f\"{profile['database']}.{profile['schema']}.{stage_name.upper()}\"\n\n    try:\n        # Create cursor\n        cursor = conn.cursor()\n\n        # Create stage if not exists\n        print(f\"Creating stage {stage_name}...\")\n        cursor.execute(f\"CREATE STAGE IF NOT EXISTS {stage_name}\")\n\n        # Upload ZIP file to stage\n        print(f\"Uploading ZIP file to stage {stage_name}...\")\n        # Normalize path for Snowflake PUT command\n        zip_file_path_norm = os.path.abspath(zip_file_path).replace('\\\\', '/')\n        # Disable auto-compression to ensure file remains as .zip only\n        upload_cmd = f\"PUT file://{zip_file_path_norm} @{stage_name} AUTO_COMPRESS=FALSE OVERWRITE=TRUE\"\n        cursor.execute(upload_cmd)\n        print(\"Upload completed successfully!\")\n\n        return stage_name\n\n    finally:\n        conn.close()\n\ndef main():\n    parser = argparse.ArgumentParser(description='Set up brewdata package with dbt Core and Snowflake')\n    parser.add_argument('--url', default=\"https://github.com/brewdata/brewdata-dbt-Snowflake/releases/download/main/brewdata_lib.zip\", help='GitHub URL for the brewdata package')\n    parser.add_argument('--download_path', default='.', help='Path to download the brewdata package')\n    parser.add_argument('--stage_name', help='Custom stage name (optional)')\n    parser.add_argument('--keep_zip', action='store_true', help='Keep the ZIP file after upload')\n    args = parser.parse_args()\n\n    try:\n        # Install required packages\n        # install_required_packages()\n\n        # Get Snowflake profile from dbt\n        profile_name, profile = get_dbt_profile()\n        print(f\"Using profile: {profile_name}\")\n        print(f\"Snowflake connection: {profile['user']}@{profile['account']}\")\n\n        # Download brewdata package\n        zip_file_path = download_brewdata_package(args.download_path, args.url)\n\n        # Create stage and upload\n        stage_name = create_snowflake_stage_and_upload(profile, zip_file_path, args.stage_name)\n\n        # Delete the ZIP file after upload unless --keep_zip is specified\n        if not args.keep_zip and os.path.exists(zip_file_path):\n            print(f\"Removing temporary ZIP file: {zip_file_path}\")\n            os.remove(zip_file_path)\n\n        # Print instructions for the user\n        print(\"\\nSetup Complete!\")\n        print(\"===================================\")\n        print(\"To use brewdata in your dbt-Python model, include the following in your model file:\")\n        print(f\"\"\"\ndef model(dbt, session):\n    dbt.config(\n         materialized=\"table\",\n         packages=[\"shapely\", \"transformers\", \"sympy\", \"faker\", \"requests\", \"xmltodict\", \"xmlschema\", \n                   \"pandas\", \"numpy\", \"scikit-learn\", \"scipy\", \"tqdm\", \"pytorch\", \"datasets\"],\n         imports=['@{stage_name}/brewdata_lib.zip'] # change to your @{{DB_NAME}}.{{SCHEMA_NAME}}.{{STAGE_NAME}}/brewdata_lib.zip\n    )\n\n    # Import custom brewdata module AFTER the config call\n    from brewdata_dbt import FileSyntheticData\n\n    # Your code here\n    # ...\n\"\"\")\n\n    except Exception as e:\n        print(f\"Error: {e}\")\n        import traceback\n        traceback.print_exc()\n        return 1\n\n    return 0\n\nif __name__ == \"__main__\":\n    exit_code = main()\n    exit(exit_code)\n</code></pre></li> </ol>"},{"location":"example/quickstart-setup/#2-run-script","title":"2. Run Script","text":"<ul> <li>run the below command to run the script   <pre><code>python brewdata_setup.py\n</code></pre></li> <li>select the profile and it will place the <code>brewwdata_lib.zip</code>inside the <code>BREWDATA_PACKAGE</code> stage of your <code>Database</code>.</li> <li>(optional) you can provide the stage name while running the script to upload zip file.   <pre><code>python brewdata_setup.py --stage_name &lt;STAGE_NAME_TO_UPLOAD_PACKAGE&gt;\n</code></pre></li> </ul>"},{"location":"example/quickstart-setup/#step-3manual-download-and-upload-the-brewdata-package","title":"Step 3(Manual): Download and Upload the brewdata Package","text":""},{"location":"example/quickstart-setup/#1-download-the-brewdata-package","title":"1. Download the brewdata package","text":"<p>Get the brewdata package ZIP file from the official GitHub repository here.</p>"},{"location":"example/quickstart-setup/#2-upload-the-package-to-snowflake","title":"2. Upload the package to Snowflake","text":"<p>Log in to your Snowflake account via the web UI and follow these steps:</p>"},{"location":"example/quickstart-setup/#3-create-a-snowflake-stage","title":"3. Create a Snowflake Stage","text":"<ol> <li>Navigate to Data in the left-hand menu.</li> <li>Select your database and schema.</li> <li>Click Create &gt; Stage.</li> <li>Name the stage, e.g., <code>&lt;YOUR_SNOWFLAKE_STAGE&gt;</code>.</li> <li>Choose Internal Stage and complete the setup.</li> </ol>"},{"location":"example/quickstart-setup/#4-upload-the-zip-file-to-the-stage","title":"4. Upload the ZIP File to the Stage","text":"<ol> <li>Open the newly created stage.</li> <li>Click Upload and select the brewdata ZIP file.</li> <li>Wait for the upload to complete.</li> </ol>"},{"location":"example/quickstart-setup/#step-4-run-a-dbt-model-with-the-brewdata-package","title":"Step 4: Run a dbt Model with the brewdata Package","text":"<p>Your dbt-python model (inside the <code>models</code> directory) can import the brewdata package and use it within the model.</p>"},{"location":"example/quickstart-setup/#example-using-brewdata-in-a-dbt-python-model","title":"Example: Using brewdata in a dbt-Python Model","text":"<p>Create a new Python model (<code>models/brewdata_dbt_model.py</code>) and include the following code:</p> <pre><code>def model(dbt, session):\n    # Configure the model with required packages and brewdata import\n    dbt.config(\n         materialized=\"table\",\n         packages=[\"shapely\",\"transformers\",\"sympy\", \"faker\", \"requests\", \"xmltodict\", \"xmlschema\", \"pandas\", \"numpy\", \"scikit-learn\", \"scipy\", \"tqdm\", \"pytorch\", \"datasets\"],\n         # tested on python 3.10\n         # packages=[\"shapely==2.0.5\", \"transformers==4.45.2\", \"sympy==1.13.3\", \"faker==30.8.1\", \"requests==2.32.3\", \"xmltodict==0.13.0\", \"xmlschema==2.3.1\", \"pandas==2.0.3\", \"numpy==1.24.3\", \"scikit-learn==1.3.0\", \"scipy==1.10.1\", \"tqdm==4.66.5\", \"pytorch==2.3.0\", \"datasets==2.19.1\"],\n\n         imports=['@BREWDATA_PUBLIC.PUBLIC.PUBLIC_STAGE/brewdata_lib.zip'] # change to your @{DB_NAME}.{SCHEMA_NAME}.{STAGE_NAME}/brewdata_lib.zip\n    )\n\n    # Import custom brewdata module AFTER the config call\n    from brewdata_dbt import FileSyntheticData\n\n    # Fetch customer data from an upstream model\n    customer_data = dbt.source(\"public\", \"customer\") # (schema name, table name)\n    df = customer_data.to_pandas()\n\n    fsd = FileSyntheticData(df=df, locale='en-US')\n\n    # Configuration for synthetic data generation\n    config={\"columns_config\":[\n                              {\"source_column\": \"gender\",\n                              \"pattern\":None, \n                              \"pattern_id\":None, \n                              \"strategy_id\":59, \n                              \"dependent_fields\":[],\n                              \"tokenization_type\": \"NA\"}\n                          ]}\n\n    # Generate synthetic data\n    fsd.start_synthetic(df, config, \"en-US\", limit=None, table_data=None, bias=None)\n    ddf = fsd.synthetic_file_content\n    return ddf\n</code></pre>"},{"location":"example/quickstart-setup/#step-5-run-the-model","title":"Step 5: Run the Model","text":"<p>Execute the following command to run the model:</p> <pre><code>dbt run --select brewdata_dbt_model\n</code></pre>"}]}